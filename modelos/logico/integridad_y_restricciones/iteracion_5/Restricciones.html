<html>
<head>
  <style>
    body { color: black; font-family: Arial, sans-serif; }
    table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
    th, td { border: 1px solid #333; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
  </style>
</head>
<body>
<h1>INTEGRIDAD REFERENCIAL Y RESTRICCIONES SEMÃNTICAS</h1>
<h2>Modelo LÃ³gico BICI-GO v5.0 â€“ Rol: DiseÃ±ador LÃ³gico</h2>
<hr>

<h3>ğŸ§± PARTE 1. UNICIDAD</h3>
<table>
<tr><th>Tabla</th><th>Campo(s)</th><th>RestricciÃ³n</th><th>Prioridad</th><th>DescripciÃ³n</th></tr>
<tr><td>pais</td><td>nombre</td><td>UNIQUE</td><td>ğŸŸ¢</td><td>Nombre de paÃ­s Ãºnico.</td></tr>
<tr><td>ciudad</td><td>(nombre, id_pais)</td><td>UNIQUE</td><td>ğŸŸ¢</td><td>Nombre de ciudad Ãºnico dentro de un paÃ­s.</td></tr>
<tr><td>punto_alquiler</td><td>nombre</td><td>UNIQUE</td><td>ğŸŸ¡</td><td>Nombre Ãºnico de punto de alquiler.</td></tr>
<tr><td>persona</td><td>(documento_tipo, documento_numero)</td><td>UNIQUE</td><td>ğŸ”´</td><td>Documento Ãºnico por persona.</td></tr>
<tr><td>cliente</td><td>usuario</td><td>UNIQUE</td><td>ğŸ”´</td><td>Usuario Ãºnico en el sistema.</td></tr>
<tr><td>bicicleta</td><td>codigo_unico</td><td>UNIQUE</td><td>ğŸ”´</td><td>CÃ³digo Ãºnico de bicicleta.</td></tr>
<tr><td>metodo_de_pago</td><td>nombre</td><td>UNIQUE</td><td>ğŸŸ¢</td><td>Nombre Ãºnico de mÃ©todo de pago.</td></tr>
<tr><td>servicio</td><td>nombre</td><td>UNIQUE</td><td>ğŸŸ¢</td><td>Nombre Ãºnico de servicio.</td></tr>
<tr><td>etiqueta</td><td>nombre</td><td>UNIQUE</td><td>ğŸŸ¢</td><td>Nombre Ãºnico de etiqueta.</td></tr>
</table>

<hr>
<h3>ğŸ”— PARTE 2. INTEGRIDAD REFERENCIAL</h3>
<table>
<tr><th>Tabla origen</th><th>Campo FK</th><th>Tabla destino</th><th>Regla</th><th>Prioridad</th><th>DescripciÃ³n</th></tr>
<tr><td>ciudad</td><td>id_pais</td><td>pais</td><td>ON DELETE RESTRICT</td><td>ğŸŸ¢</td><td>Una ciudad requiere un paÃ­s vÃ¡lido.</td></tr>
<tr><td>punto_alquiler</td><td>id_ciudad</td><td>ciudad</td><td>ON DELETE CASCADE</td><td>ğŸŸ¡</td><td>Eliminar ciudad borra sus puntos.</td></tr>
<tr><td>contacto_punto</td><td>id_persona</td><td>persona</td><td>ON DELETE CASCADE</td><td>ğŸŸ¡</td><td>Elimina contactos si la persona se borra.</td></tr>
<tr><td>cliente</td><td>id_persona</td><td>persona</td><td>ON DELETE RESTRICT</td><td>ğŸ”´</td><td>Un cliente requiere persona asociada.</td></tr>
<tr><td>reserva</td><td>id_cliente</td><td>cliente</td><td>ON DELETE RESTRICT</td><td>ğŸ”´</td><td>No se elimina cliente con reservas.</td></tr>
<tr><td>reserva</td><td>id_metodo_de_pago</td><td>metodo_de_pago</td><td>ON DELETE SET NULL</td><td>ğŸŸ¡</td><td>Reserva puede quedar sin mÃ©todo si se elimina.</td></tr>
<tr><td>detalle_alquiler</td><td>id_reserva</td><td>reserva</td><td>ON DELETE CASCADE</td><td>ğŸŸ¢</td><td>Eliminar reserva borra detalles.</td></tr>
<tr><td>reserva_descuento</td><td>id_descuento</td><td>descuento</td><td>ON DELETE CASCADE</td><td>ğŸŸ¡</td><td>Eliminar descuento borra relaciÃ³n.</td></tr>
<tr><td>cobertura_seguro</td><td>id_bicicleta</td><td>bicicleta</td><td>ON DELETE CASCADE</td><td>ğŸ”´</td><td>Eliminar bicicleta borra sus coberturas.</td></tr>
<tr><td>detalle_dia_horario</td><td>id_punto_alquiler</td><td>punto_alquiler</td><td>ON DELETE CASCADE</td><td>ğŸŸ¢</td><td>Eliminar punto borra horarios.</td></tr>
<tr><td>excepcion_horario</td><td>id_punto_alquiler</td><td>punto_alquiler</td><td>ON DELETE CASCADE</td><td>ğŸŸ¢</td><td>Eliminar punto borra excepciones.</td></tr>
</table>

<hr>
<h3>âš™ï¸ PARTE 3. INTEGRIDAD SEMÃNTICA GENERAL</h3>
<table>
<tr><th>Tabla</th><th>Campo(s)</th><th>CondiciÃ³n</th><th>Prioridad</th><th>DescripciÃ³n</th></tr>
<tr><td>cliente</td><td>contraseÃ±a</td><td>Formato seguro (hash)</td><td>ğŸ”´</td><td>Las contraseÃ±as deben almacenarse cifradas.</td></tr>
<tr><td>bicicleta</td><td>anio_fabricacion</td><td>&gt;= 1900 AND &lt;= aÃ±o actual</td><td>ğŸŸ¢</td><td>AÃ±o vÃ¡lido de fabricaciÃ³n.</td></tr>
<tr><td>punto_alquiler</td><td>fecha_fin</td><td>NULL o &gt; fecha_inicio</td><td>ğŸŸ¢</td><td>Coherencia temporal.</td></tr>
<tr><td>detalle_dia_horario</td><td>id_dia_semana</td><td>IN (1â€“7)</td><td>ğŸŸ¢</td><td>DÃ­as vÃ¡lidos de la semana.</td></tr>
<tr><td>descuento</td><td>valor</td><td>&gt; 0</td><td>ğŸ”´</td><td>El valor del descuento debe ser positivo.</td></tr>
<tr><td>reserva</td><td>total_general</td><td>= subtotal_general - descuento_total + iva_total</td><td>ğŸ”´</td><td>Consistencia en cÃ¡lculo de totales.</td></tr>
<tr><td>fotografia</td><td>formato</td><td>IN (JPG, PNG, WEBP, GIF)</td><td>ğŸŸ¡</td><td>Formatos vÃ¡lidos de imagen.</td></tr>
</table>
<hr>
<h3>ğŸ§® PARTE 4. REGLAS DE NEGOCIO</h3>
<table>
  <tr><th>ID Regla</th><th>Nombre</th><th>CondiciÃ³n / DescripciÃ³n</th><th>Impacto</th><th>Prioridad</th></tr>

  <tr>
    <td>RN-01</td>
    <td>Disponibilidad de bicicleta</td>
    <td>Solo se alquila si estado operativo vigente = 'disponible' y la bicicleta estÃ¡ asociada a un punto activo.</td>
    <td>Control de flujo</td>
    <td>ğŸ”´</td>
  </tr>

  <tr>
    <td>RN-02</td>
    <td>Capacidad de punto</td>
    <td>Registro de alquiler o devoluciÃ³n requiere que capacidad.espacios_disponibles &gt; 0 en el punto destino.</td>
    <td>PrevenciÃ³n de saturaciÃ³n</td>
    <td>ğŸ”´</td>
  </tr>

  <tr>
    <td>RN-03</td>
    <td>RestricciÃ³n por horario</td>
    <td>Operaciones (inicio/fin de alquiler) deben ocurrir dentro de detalle_dia_horario para el punto. Excepciones vÃ¡lidas aplican.</td>
    <td>Control operacional</td>
    <td>ğŸŸ¡</td>
  </tr>

  <tr>
    <td>RN-04</td>
    <td>Mantenimiento preventivo</td>
    <td>Si uso_acumulado (km_total u horas_total) supera umbrales de parametro_mantenimiento, la bicicleta cambia a estado operativo 'mantenimiento'.</td>
    <td>Seguridad</td>
    <td>ğŸ”´</td>
  </tr>

  <tr>
    <td>RN-05</td>
    <td>AsignaciÃ³n de etiquetas</td>
    <td>No se permiten duplicados de (id_bicicleta, id_etiqueta, fecha_asignacion). Una etiqueta puede tener fecha_eliminacion para desactivaciÃ³n.</td>
    <td>Consistencia informativa</td>
    <td>ğŸŸ¢</td>
  </tr>

  <tr>
    <td>RN-06</td>
    <td>Tarifa vigente Ãºnica</td>
    <td>Por combinaciÃ³n (id_plan, id_bicicleta) solo puede existir una tarifa con fecha_fin IS NULL.</td>
    <td>Control de precios</td>
    <td>ğŸ”´</td>
  </tr>

  <tr>
    <td>RN-07</td>
    <td>Seguro activo por tipo</td>
    <td>Para cada bicicleta y tipo de cobertura, solo una cobertura_seguro con estado = 'activo' y dentro de su vigencia.</td>
    <td>GestiÃ³n de seguros</td>
    <td>ğŸŸ¡</td>
  </tr>

  <tr>
    <td>RN-08</td>
    <td>Trazabilidad administrativa</td>
    <td>Operaciones que cambian estado, tarifas, coberturas, ubicaciÃ³n o capacidad deben registrar id_admin vÃ¡lido.</td>
    <td>AuditorÃ­a y control</td>
    <td>ğŸ”´</td>
  </tr>

  <tr>
    <td>RN-09</td>
    <td>No solapamiento de horarios</td>
    <td>Las excepciones de horario no pueden solaparse entre sÃ­ ni con el horario base para la misma fecha/punto.</td>
    <td>Coherencia temporal</td>
    <td>ğŸŸ¢</td>
  </tr>

  <tr>
    <td>RN-10</td>
    <td>Sincronicidad de estados</td>
    <td>Actualizaciones de estado_operativo deben revisar/actualizar estado_fisico correspondiente (ej. 'en revisiÃ³n' al pasar a mantenimiento).</td>
    <td>GestiÃ³n tÃ©cnica</td>
    <td>ğŸŸ¡</td>
  </tr>
</table>
<hr>
<h3>ğŸ”’ PARTE 5. SEGURIDAD LÃ“GICA</h3>
<p>Estas restricciones definen los permisos y limitaciones segÃºn el rol de usuario dentro del sistema BICI-GO v5.0.</p>
<table>
<tr><th>Rol</th><th>Permisos principales</th><th>Restricciones</th><th>Observaciones</th></tr>

<tr>
<td><b>Administrador</b></td>
<td>Insert, Update, Delete, Select</td>
<td>Ninguna</td>
<td>Control total sobre todas las entidades. Responsable de trazabilidad mediante <code>id_admin</code>.</td>
</tr>

<tr>
<td><b>Operador</b></td>
<td>Insert, Update, Select</td>
<td>No puede eliminar registros crÃ­ticos (bicicleta, plan, tarifa, cliente).</td>
<td>Gestiona reservas, devoluciones y disponibilidad en puntos de alquiler.</td>
</tr>

<tr>
<td><b>Cliente</b></td>
<td>Select, Insert</td>
<td>No puede modificar ni eliminar datos maestros.</td>
<td>Solo puede iniciar reservas, consultar planes y registrar devoluciones.</td>
</tr>

<tr>
<td><b>TÃ©cnico de mantenimiento</b></td>
<td>Insert, Update</td>
<td>No puede modificar datos de usuarios, reservas ni tarifas.</td>
<td>Se limita a registrar mantenimientos y actualizar estados operativos/fÃ­sicos de bicicletas.</td>
</tr>

<tr>
<td><b>Auditor</b></td>
<td>Select</td>
<td>No puede modificar datos.</td>
<td>Accede a vistas consolidadas para control de gestiÃ³n y trazabilidad.</td>
</tr>
</table>

<hr>
<h3>ğŸ§¾ PARTE 6. OBSERVACIONES FINALES</h3>
<ol>
<li>Todos los registros que incluyan <code>id_admin</code> deben mantener trazabilidad con el administrador responsable.</li>
<li>Los campos de tipo <b>fecha</b> y <b>hora</b> siguen la convenciÃ³n UTC-5 (BogotÃ¡) y valores por defecto del servidor.</li>
<li>Los campos de auditorÃ­a (<code>fecha_creacion</code>, <code>fecha_actualizacion</code>, <code>fecha_inicio</code>, <code>fecha_fin</code>) son obligatorios en entidades histÃ³ricas o de control.</li>
<li>El sistema debe soportar <b>transacciones atÃ³micas</b> para garantizar consistencia ante fallas.</li>
<li>Los valores enumerados (estados, tipos, condiciones) deben implementarse con <b>CHECK constraints</b> o tablas de referencia.</li>
<li>Se recomiendan <b>Ã­ndices compuestos</b> en campos usados frecuentemente para bÃºsquedas o validaciones (ej. <code>(id_pais, nombre_ciudad)</code>, <code>(id_plan, id_bicicleta)</code>).</li>
<li>Las contraseÃ±as de clientes y administradores deben almacenarse en formato seguro (hash + salt).</li>
<li>Los registros de reservas deben validar consistencia de totales: <code>total_general = subtotal_general - descuento_total + iva_total</code>.</li>
</ol>

<hr>
<h3>ğŸ“˜ ConclusiÃ³n</h3>
<p>El modelo lÃ³gico BICI-GO v5.0 consolida la estructura referencial, semÃ¡ntica y de seguridad del sistema,<br>
integrando mecanismos de control, trazabilidad y consistencia de datos.<br>
Su diseÃ±o soporta la expansiÃ³n futura de servicios, coberturas, reservas y mÃ©todos de pago,<br>
manteniendo la integridad relacional y las normas de calidad de datos exigidas en sistemas distribuidos.</p>

<blockquote>
<p><strong>VersiÃ³n:</strong> 5.0<br>
<strong>Rol responsable:</strong> DiseÃ±ador LÃ³gico<br>
<strong>Sistema:</strong> BICI-GO<br>
<strong>ActualizaciÃ³n:</strong> Noviembre de 2025</p>
</blockquote>

