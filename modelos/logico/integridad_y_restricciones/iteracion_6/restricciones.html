<html>
<head>
  <style>
    body { color: black; font-family: Arial, sans-serif; }
    table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
    th, td { border: 1px solid #333; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
  </style>
</head>
<body>
<h1>INTEGRIDAD REFERENCIAL Y RESTRICCIONES SEMÃNTICAS</h1>
<h2>Modelo LÃ³gico BICI-GO v6.0 â€“ Rol: DiseÃ±ador LÃ³gico</h2>
<hr>

<h3>ğŸ§± PARTE 1. UNICIDAD</h3>
<table>
<tr><th>Tabla</th><th>Campo(s)</th><th>RestricciÃ³n</th><th>Prioridad</th><th>DescripciÃ³n</th></tr>
<tr><td>pais</td><td>nombre</td><td>UNIQUE</td><td>ğŸŸ¢</td><td>Nombre de paÃ­s Ãºnico.</td></tr>
<tr><td>ciudad</td><td>(nombre, id_pais)</td><td>UNIQUE</td><td>ğŸŸ¢</td><td>Nombre de ciudad Ãºnico dentro de un paÃ­s.</td></tr>
<tr><td>punto_alquiler</td><td>nombre</td><td>UNIQUE</td><td>ğŸŸ¡</td><td>Nombre Ãºnico de punto de alquiler.</td></tr>
<tr><td>persona</td><td>(documento_tipo, documento_numero)</td><td>UNIQUE</td><td>ğŸ”´</td><td>Documento Ãºnico por persona.</td></tr>
<tr><td>cliente</td><td>usuario</td><td>UNIQUE</td><td>ğŸ”´</td><td>Usuario Ãºnico en el sistema.</td></tr>
<tr><td>bicicleta</td><td>codigo_unico</td><td>UNIQUE</td><td>ğŸ”´</td><td>CÃ³digo Ãºnico de bicicleta.</td></tr>
<tr><td>metodo_de_pago</td><td>nombre</td><td>UNIQUE</td><td>ğŸŸ¢</td><td>Nombre Ãºnico de mÃ©todo de pago.</td></tr>
<tr><td>servicio</td><td>nombre</td><td>UNIQUE</td><td>ğŸŸ¢</td><td>Nombre Ãºnico de servicio.</td></tr>
<tr><td>etiqueta</td><td>nombre</td><td>UNIQUE</td><td>ğŸŸ¢</td><td>Nombre Ãºnico de etiqueta.</td></tr>
<tr><td>ruta_turistica</td><td>nombre</td><td>UNIQUE</td><td>ğŸŸ¡</td><td>Nombre Ãºnico de ruta turÃ­stica.</td></tr>
<tr><td>idioma</td><td>codigo_iso</td><td>UNIQUE</td><td>ğŸŸ¢</td><td>CÃ³digo ISO 639-1 Ãºnico.</td></tr>
<tr><td>idioma</td><td>codigo_iso3</td><td>UNIQUE</td><td>ğŸŸ¢</td><td>CÃ³digo ISO 639-2 Ãºnico.</td></tr>
<tr><td>guia_turistico</td><td>numero_licencia</td><td>UNIQUE</td><td>ğŸ”´</td><td>Licencia Ãºnica por guÃ­a.</td></tr>
</table>

<hr>
<h3>ğŸ”— PARTE 2. INTEGRIDAD REFERENCIAL</h3>
<table>
<tr><th>Tabla origen</th><th>Campo FK</th><th>Tabla destino</th><th>Regla</th><th>Prioridad</th><th>DescripciÃ³n</th></tr>
<tr><td>persona</td><td>id_terminos_condiciones</td><td>terminos_condiciones</td><td>ON DELETE SET NULL</td><td>ğŸŸ¡</td><td>Permite que una persona quede sin versiÃ³n activa si se elimina.</td></tr>
<tr><td>guia_turistico</td><td>id_persona</td><td>persona</td><td>ON DELETE RESTRICT</td><td>ğŸ”´</td><td>Un guÃ­a requiere una persona asociada.</td></tr>
<tr><td>guia_ruta</td><td>id_guia_turistico</td><td>guia_turistico</td><td>ON DELETE CASCADE</td><td>ğŸŸ¢</td><td>Eliminar guÃ­a borra sus asignaciones de ruta.</td></tr>
<tr><td>guia_ruta</td><td>id_ruta</td><td>ruta_turistica</td><td>ON DELETE CASCADE</td><td>ğŸŸ¢</td><td>Eliminar ruta borra sus asignaciones.</td></tr>
<tr><td>resenia_ruta</td><td>id_reserva</td><td>reserva</td><td>ON DELETE CASCADE</td><td>ğŸŸ¡</td><td>Eliminar reserva borra reseÃ±as asociadas.</td></tr>
<tr><td>resenia_ruta</td><td>id_ruta</td><td>ruta_turistica</td><td>ON DELETE CASCADE</td><td>ğŸŸ¡</td><td>Eliminar ruta borra reseÃ±as.</td></tr>
<tr><td>foto_resenia</td><td>id_resenia_ruta</td><td>resenia_ruta</td><td>ON DELETE CASCADE</td><td>ğŸŸ¢</td><td>Eliminar reseÃ±a borra sus fotos.</td></tr>
<tr><td>guia_idioma</td><td>id_guia_turistico</td><td>guia_turistico</td><td>ON DELETE CASCADE</td><td>ğŸŸ¢</td><td>Eliminar guÃ­a borra sus idiomas.</td></tr>
<tr><td>guia_idioma</td><td>id_idioma</td><td>idioma</td><td>ON DELETE RESTRICT</td><td>ğŸŸ¢</td><td>No se elimina idioma si estÃ¡ asignado.</td></tr>
</table>

<hr>
<h3>âš™ï¸ PARTE 3. INTEGRIDAD SEMÃNTICA GENERAL</h3>
<table>
<tr><th>Tabla</th><th>Campo(s)</th><th>CondiciÃ³n</th><th>Prioridad</th><th>DescripciÃ³n</th></tr>
<tr><td>terminos_condiciones</td><td>version</td><td>&gt;= 1</td><td>ğŸŸ¢</td><td>Versiones deben ser positivas.</td></tr>
<tr><td>ruta_turistica</td><td>nivel_dificultad</td><td>IN (baja, media, alta)</td><td>ğŸ”´</td><td>Niveles vÃ¡lidos de dificultad.</td></tr>
<tr><td>ruta_turistica</td><td>tipo_terreno</td><td>IN (urbano, rural, mixto)</td><td>ğŸŸ¡</td><td>Tipos vÃ¡lidos de terreno.</td></tr>
<tr><td>idioma</td><td>codigo_iso</td><td>PatrÃ³n [a-z]{2}</td><td>ğŸŸ¢</td><td>CÃ³digo ISO 639-1.</td></tr>
<tr><td>idioma</td><td>codigo_iso3</td><td>PatrÃ³n [a-z]{3}</td><td>ğŸŸ¢</td><td>CÃ³digo ISO 639-2.</td></tr>
<tr><td>guia_ruta</td><td>veces_realizada</td><td>&gt;= 0</td><td>ğŸŸ¢</td><td>No puede ser negativo.</td></tr>
<tr><td>resenia_ruta</td><td>calificacion</td><td>IN (1â€“5)</td><td>ğŸ”´</td><td>Escala de calificaciÃ³n vÃ¡lida.</td></tr>
</table> 
<hr>
<h3>ğŸ§® PARTE 4. REGLAS DE NEGOCIO</h3>
<table>
  <tr><th>ID Regla</th><th>Nombre</th><th>CondiciÃ³n / DescripciÃ³n</th><th>Impacto</th><th>Prioridad</th></tr>

  <tr>
    <td>RN-01</td>
    <td>Disponibilidad de bicicleta</td>
    <td>Solo se alquila si estado operativo vigente = 'disponible' y la bicicleta estÃ¡ asociada a un punto activo.</td>
    <td>Control de flujo</td>
    <td>ğŸ”´</td>
  </tr>

  <tr>
    <td>RN-02</td>
    <td>Capacidad de punto</td>
    <td>Registro de alquiler o devoluciÃ³n requiere que capacidad.espacios_disponibles &gt; 0 en el punto destino.</td>
    <td>PrevenciÃ³n de saturaciÃ³n</td>
    <td>ğŸ”´</td>
  </tr>

  <tr>
    <td>RN-03</td>
    <td>RestricciÃ³n por horario</td>
    <td>Operaciones (inicio/fin de alquiler) deben ocurrir dentro de detalle_dia_horario para el punto. Excepciones vÃ¡lidas aplican.</td>
    <td>Control operacional</td>
    <td>ğŸŸ¡</td>
  </tr>

  <tr>
    <td>RN-04</td>
    <td>Mantenimiento preventivo</td>
    <td>Si uso_acumulado (km_total u horas_total) supera umbrales de parametro_mantenimiento, la bicicleta cambia a estado operativo 'mantenimiento'.</td>
    <td>Seguridad</td>
    <td>ğŸ”´</td>
  </tr>

  <tr>
    <td>RN-05</td>
    <td>AsignaciÃ³n de etiquetas</td>
    <td>No se permiten duplicados de (id_bicicleta, id_etiqueta, fecha_asignacion). Una etiqueta puede tener fecha_eliminacion para desactivaciÃ³n.</td>
    <td>Consistencia informativa</td>
    <td>ğŸŸ¢</td>
  </tr>

  <tr>
    <td>RN-06</td>
    <td>Tarifa vigente Ãºnica</td>
    <td>Por combinaciÃ³n (id_plan, id_bicicleta) solo puede existir una tarifa con fecha_fin IS NULL.</td>
    <td>Control de precios</td>
    <td>ğŸ”´</td>
  </tr>

  <tr>
    <td>RN-07</td>
    <td>Seguro activo por tipo</td>
    <td>Para cada bicicleta y tipo de cobertura, solo una cobertura_seguro con estado = 'activo' y dentro de su vigencia.</td>
    <td>GestiÃ³n de seguros</td>
    <td>ğŸŸ¡</td>
  </tr>

  <tr>
    <td>RN-08</td>
    <td>Trazabilidad administrativa</td>
    <td>Operaciones que cambian estado, tarifas, coberturas, ubicaciÃ³n o capacidad deben registrar id_admin vÃ¡lido.</td>
    <td>AuditorÃ­a y control</td>
    <td>ğŸ”´</td>
  </tr>

  <tr>
    <td>RN-09</td>
    <td>No solapamiento de horarios</td>
    <td>Las excepciones de horario no pueden solaparse entre sÃ­ ni con el horario base para la misma fecha/punto.</td>
    <td>Coherencia temporal</td>
    <td>ğŸŸ¢</td>
  </tr>

  <tr>
    <td>RN-10</td>
    <td>Sincronicidad de estados</td>
    <td>Actualizaciones de estado_operativo deben revisar/actualizar estado_fisico correspondiente (ej. 'en revisiÃ³n' al pasar a mantenimiento).</td>
    <td>GestiÃ³n tÃ©cnica</td>
    <td>ğŸŸ¡</td>
  </tr>

  <tr>
    <td>RN-11</td>
    <td>AceptaciÃ³n de tÃ©rminos</td>
    <td>Una persona no puede operar si no ha aceptado la versiÃ³n actual de tÃ©rminos.</td>
    <td>Legal y cumplimiento</td>
    <td>ğŸ”´</td>
  </tr>

  <tr>
    <td>RN-12</td>
    <td>Disponibilidad de guÃ­a</td>
    <td>Un guÃ­a turÃ­stico solo puede ser asignado si esta_disponible = true y tiene al menos un idioma activo.</td>
    <td>GestiÃ³n de rutas</td>
    <td>ğŸ”´</td>
  </tr>

  <tr>
    <td>RN-13</td>
    <td>ValidaciÃ³n de reseÃ±as</td>
    <td>Solo se puede registrar una reseÃ±a por combinaciÃ³n (id_reserva, id_ruta).</td>
    <td>Control de duplicidad</td>
    <td>ğŸŸ¡</td>
  </tr>

  <tr>
    <td>RN-14</td>
    <td>Idioma activo</td>
    <td>Un idioma solo puede ser asignado si su estado = 'activo'.</td>
    <td>InternacionalizaciÃ³n</td>
    <td>ğŸŸ¢</td>
  </tr>

  <tr>
    <td>RN-15</td>
    <td>Tarifa de guÃ­a</td>
    <td>La tarifa base del guÃ­a debe ser mayor a cero y registrada antes de asignar rutas.</td>
    <td>Control financiero</td>
    <td>ğŸ”´</td>
  </tr>
</table>

<hr>
<h3>ğŸ”’ PARTE 5. SEGURIDAD LÃ“GICA</h3>
<table>
<tr><th>Rol</th><th>Permisos principales</th><th>Restricciones</th><th>Observaciones</th></tr>

<tr>
<td><b>Administrador</b></td>
<td>Insert, Update, Delete, Select</td>
<td>Ninguna</td>
<td>Control total sobre todas las entidades. Responsable de trazabilidad mediante <code>id_admin</code>.</td>
</tr>

<tr>
<td><b>Operador</b></td>
<td>Insert, Update, Select</td>
<td>No puede eliminar registros crÃ­ticos (bicicleta, plan, tarifa, cliente).</td>
<td>Gestiona reservas, devoluciones y disponibilidad en puntos de alquiler.</td>
</tr>

<tr>
<td><b>Cliente</b></td>
<td>Select, Insert</td>
<td>No puede modificar ni eliminar datos maestros.</td>
<td>Solo puede iniciar reservas, consultar planes y registrar devoluciones.</td>
</tr>

<tr>
<td><b>TÃ©cnico de mantenimiento</b></td>
<td>Insert, Update</td>
<td>No puede modificar datos de usuarios, reservas ni tarifas.</td>
<td>Se limita a registrar mantenimientos y actualizar estados operativos/fÃ­sicos de bicicletas.</td>
</tr>

<tr>
<td><b>Auditor</b></td>
<td>Select</td>
<td>No puede modificar datos.</td>
<td>Accede a vistas consolidadas para control de gestiÃ³n y trazabilidad.</td>
</tr>

<tr>
<td><b>GuÃ­a turÃ­stico</b></td>
<td>Select, Insert</td>
<td>No puede modificar rutas ni reseÃ±as ajenas.</td>
<td>Registra disponibilidad, idiomas y acepta tÃ©rminos.</td>
</tr>

<tr>
<td><b>Usuario turista</b></td>
<td>Select, Insert</td>
<td>No puede modificar rutas ni guÃ­as.</td>
<td>Puede registrar reseÃ±as y consultar rutas.</td>
</tr>

<tr>
<td><b>Coordinador de rutas</b></td>
<td>Insert, Update, Select</td>
<td>No puede eliminar rutas ni guÃ­as.</td>
<td>Asigna rutas, valida disponibilidad y gestiona reseÃ±as.</td>
</tr>
</table>

<hr>
<h3>ğŸ§¾ PARTE 6. OBSERVACIONES FINALES</h3>
<ol>
<li>Las entidades que incluyan <code>id_terminos_condiciones</code> deben validar vigencia y aceptaciÃ³n.</li>
<li>Las rutas turÃ­sticas deben tener al menos un guÃ­a disponible para ser activadas.</li>
<li>Las reseÃ±as deben cumplir con formato, calificaciÃ³n vÃ¡lida y estar asociadas a reservas reales.</li>
<li>Los idiomas deben seguir estÃ¡ndares ISO y estar activos para ser asignables.</li>
<li>Las nuevas entidades mantienen coherencia temporal mediante campos como <code>fecha_asignacion</code>, <code>fecha_publicacion</code>, <code>fecha_creacion</code>.</li>
<li>Se recomienda indexar combinaciones como <code>(id_guia_turistico, id_ruta)</code> y <code>(id_reserva, id_ruta)</code> para validaciones rÃ¡pidas.</li>
<li>Los roles nuevos deben respetar las restricciones de seguridad lÃ³gica y trazabilidad.</li>
</ol>
